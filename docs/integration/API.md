## Headless API

For headless integration EBA provides developers HTTP-based API to send questions, run reasoning, debug and test the environment. All the API methods take and return JSON-encoded data in request/response body.

### Authentication

In order to use API you must to create an EBA session first. Please use the following endpoint to setup a session:

`POST /assistant/setup`

You will need to pass a session config as a request body. Please refer to [headless integration](./Headless.md) to read more about session config. Once completed the request will return the following data:

* `session` - session ID - you will need it to run subsequent APIs within the session

This request will also return a set cookie header. You will need to pass cookies to all the subsequent API requests. You will also need to set `x-cca-sessionid` header and pass session ID of your current session with every API request.

### Get list of possible annotations 

`POST /api/v0/tag`

Get information about all the possible annotations as well as POS-tags for a specific question.

The request takes a JSON object with the following data:

* `question` - the question to be analyzed (string)

The request returns a non-empty JSON list of parse trees. Note that multiple trees can be produced and annotated from a single user question. This is because services such as spell-checker and language translation may detect another variant of interpretation. Each tree is represented in the same format as input tokens in the [annotate endpoint](../lab/endpoints/Annotate.md#parse-tree-format).

* anntoations -- concept annotations applied to a given token, including the name of the concept and the score assigned to it, e.g. `:Joke` annotates 'joke' with a score of 1.0. 
* token -- the syntatic features of a given token, e.g. part of speech tag, lemma, synonyms, and text position.

### Get all the possible interpreatations 
 
`POST /api/v0/try`

Analyze a question and get the possible interpretations. The request body should be a JSON object:

```
{
  question (string): he question to be analyzed
}
```

The response contains a JSON list with the possible interpretations (limited by top 50 items). The interpretations are sorted by reasoning score (so the first one has the highest score).

Each interpretation is represented as a JSON object:

```
{
  nodeId (string):      a link to the root node,
  score (array): [      components of the score,
    support (number),
    creativity (number),
    similarity (number)
  ],
  scoreNr (number):     a resulting reasoning score used to evaluate the interpretation,
  text (string):        a text description generated by NLG (can be null),
  depTree (array):      a semantic tree which shows the selected concepts and semantic actions (dependency tree)
}
```

A dependency tree is represented as a JSON array of two elements, where the first element is a root label, the second on is a sub forest:

```
[
  rootLabel,
  [
    subTree1,
    subTree2,
    ...
  ]
]
```

Each element (node) of the dependency tree has the following format:

```
{
  node (string):    a name of the selected concept,
  action (string):  a name of the selected semantic action,
  score (number):   a similarity metric for the specific node,
  version (number): a numeric version of the node which usually indicates which conversation this node belongs to
}
```

Here is an example of the output for the question "tell me a joke":

```
[ { depTree:
     [ { action: 'common:ShowDataMessage',
         node: ':ActionShow',
         score: 3,
         version: 2 },
       [ [ { action: 'jokes:NextJoke', node: ':Joke', score: 1, version: 2 },
           [] ] ] ],
    nodeId: '20fe0df30173f09c7d5e8a45ed170a357f9f9f92',
    score: [ 0.9375, 0, 3 ],
    scoreNr: 0.9405,
    text: 'Show me joke.' } ]
```

### Process and execute the questions 
 
`POST /api/v0/run`

Analyze a question/questions and run EBA execution.

The request takes a JSON object with the following data:

* `questions` - a JSON array of questions to be executed (where each question is a string)

You can pass more than one question. In this case questions will be run sequentially and the data created by one question will be used as a context to analyze the subsequent questions.

The request returns a JSON list with the EBA actions where each action represents changes against EBA information space. The response format is identical to what is returned to the [trace endpoint](../lab/endpoints/Trace.md).

### Side-effects

Please note that all the API requests listed above don't affect the session itself (don't change EBA information space). However `/run` API will actually execute the semantic actions which may have the side-effects (for example you can remove the records from database via semantic actions).
